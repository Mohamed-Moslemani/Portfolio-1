import{u as k,p as P,r as i,a as _,t as g,j as n,L as f}from"./index-Nbwq3Axh.js";const B=l=>{if(typeof document>"u")return;let c=document.head.querySelector('link[rel="canonical"]');c||(c=document.createElement("link"),c.rel="canonical",document.head.appendChild(c)),c.href=l},E=(l,c)=>{if(typeof document>"u")return;let e=document.getElementById(l);e||(e=document.createElement("script"),e.id=l,e.type="application/ld+json",document.head.appendChild(e)),e.textContent=JSON.stringify(c)};function q(){const{slug:l}=k(),c=P.find(t=>t.slug===l),[e,S]=i.useState(c),[M,b]=i.useState(!1),[y,u]=i.useState(""),m=i.useRef(null),[h,C]=i.useState(0),[x,T]=i.useState([]),v=_(),w=i.useRef({25:!1,50:!1,75:!1,100:!1}),$=i.useMemo(()=>{if(!e?.content)return 0;const o=e.content.replace(/<[^>]+>/g," ").trim().split(/\s+/).filter(Boolean).length;return Math.max(1,Math.ceil(o/225))},[e]);i.useEffect(()=>{b(!1)},[l]);const j=typeof window<"u"?window.location.href:"",N=async()=>{try{await navigator.clipboard.writeText(j),u("Link copied"),g({action:"blog_share_copy",category:"engagement",label:l})}catch{u("Copy failed")}setTimeout(()=>u(""),1500)},A=async()=>{try{navigator.share?(await navigator.share({title:e?.title,text:e?.excerpt||e?.title,url:j}),g({action:"blog_share_native",category:"engagement",label:l})):await N()}catch{}};return i.useEffect(()=>{const t=()=>{if(!m.current)return;const o=m.current.offsetTop,r=m.current.offsetHeight,a=window.scrollY-o,s=Math.max(1,r-window.innerHeight),d=Math.min(1,Math.max(0,a/s));C(d)};return t(),window.addEventListener("scroll",t,{passive:!0}),()=>window.removeEventListener("scroll",t)},[]),i.useEffect(()=>{if(!c?.content)return;let t=c.content;const o=[];t=t.replace(/<h([23])>(.*?)<\/h\1>/gi,(r,a,s)=>{const d=s.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$|--+/g,"-");return o.push({id:d,text:s,level:Number(a)}),`<h${a} id="${d}">${s}</h${a}>`}),T(o),S({...c,content:t}),setTimeout(()=>{m.current?.querySelectorAll("pre")?.forEach(a=>{if(a.querySelector(".code-copy"))return;const s=document.createElement("button");s.className="code-copy",s.innerText="Copy",s.addEventListener("click",()=>{const d=a.querySelector("code")?.innerText||a.innerText;navigator.clipboard.writeText(d),s.innerText="Copied!",setTimeout(()=>s.innerText="Copy",1500)}),a.style.position="relative",a.appendChild(s)})},0)},[l]),i.useEffect(()=>{if(!e)return;const t=window.location.origin,o=t+v.pathname;document.title=`${e.title} | M. Moslemani`;const r=(s,d,L)=>{let p=document.head.querySelector(`${s}[${d}="${L}"]`);return p||(p=document.createElement("meta"),p.setAttribute(d,L),document.head.appendChild(p)),p},a=e.excerpt||"Blog post";r("meta","name","description").setAttribute("content",a),r("meta","property","og:title").setAttribute("content",e.title),r("meta","property","og:description").setAttribute("content",a),r("meta","property","og:type").setAttribute("content","article"),r("meta","property","og:url").setAttribute("content",o),e.cover&&r("meta","property","og:image").setAttribute("content",t+e.cover),r("meta","property","twitter:card").setAttribute("content","summary_large_image"),r("meta","property","twitter:title").setAttribute("content",e.title),r("meta","property","twitter:description").setAttribute("content",a),e.cover&&r("meta","property","twitter:image").setAttribute("content",t+e.cover),B(o),E("ld-article",{"@context":"https://schema.org","@type":"Article",headline:e.title,datePublished:e.date,author:{"@type":"Person",name:"M. Moslemani"},description:a,mainEntityOfPage:o,...e.cover?{image:t+e.cover}:{}}),E("ld-breadcrumb",{"@context":"https://schema.org","@type":"BreadcrumbList",itemListElement:[{"@type":"ListItem",position:1,name:"Home",item:t+"/"},{"@type":"ListItem",position:2,name:"Writing",item:t+"/writing"},{"@type":"ListItem",position:3,name:e.title,item:o}]})},[e,v.pathname]),i.useEffect(()=>{if(!e)return;const t=Math.round(h*100);[25,50,75,100].forEach(o=>{!w.current[o]&&t>=o&&(w.current[o]=!0,g({action:"blog_scroll_depth",category:"engagement",label:`${o}%`,value:o}))})},[h,e]),e?n.jsxs("article",{className:"blog-page",role:"article","aria-label":e.title,children:[n.jsx("div",{className:"reading-progress","aria-hidden":"true",children:n.jsx("div",{className:"reading-progress-bar",style:{width:`${h*100}%`}})}),n.jsxs("header",{className:"blog-header",children:[n.jsxs("div",{className:"blog-header-top",children:[n.jsx("h1",{children:e.title}),n.jsxs("div",{className:"blog-share-actions","aria-label":"Share actions",children:[n.jsx("button",{type:"button",className:"btn-ghost",onClick:N,children:"Copy link"}),n.jsx("button",{type:"button",className:"btn-ghost",onClick:A,children:"Share"}),y&&n.jsx("span",{className:"share-hint",children:y})]})]}),n.jsxs("p",{className:"blog-meta",children:["Published ",new Date(e.date).toLocaleDateString()," • Last updated ",new Date(e.updated||e.date).toLocaleDateString()," • ",$," min read"]})]}),e.cover&&n.jsx("div",{className:"blog-cover-wrap",children:n.jsx("img",{src:e.cover,alt:e.title,loading:"lazy",className:`blog-cover ${M?"is-loaded":""}`,onLoad:()=>b(!0)})}),x.length>0&&n.jsx("nav",{className:"blog-toc","aria-label":"Table of contents",children:x.map(t=>n.jsx("a",{href:`#${t.id}`,className:`toc-item level-${t.level}`,children:t.text},t.id))}),n.jsx("div",{ref:m,className:"blog-content",dangerouslySetInnerHTML:{__html:e.content}}),n.jsx("footer",{className:"blog-footer",children:n.jsx(f,{to:"/",className:"btn btn-secondary",children:"Back to Portfolio"})})]}):n.jsx("div",{className:"blog-page",children:n.jsxs("div",{className:"blog-header",children:[n.jsx("h1",{children:"Post Not Found"}),n.jsx("p",{children:"The blog you are looking for doesn't exist."}),n.jsxs("div",{style:{display:"flex",gap:"0.75rem",flexWrap:"wrap"},children:[n.jsx(f,{to:"/writing",className:"btn btn-primary",children:"Browse Writing"}),n.jsx(f,{to:"/",className:"btn btn-secondary",children:"Back to Portfolio"})]})]})})}export{q as default};
