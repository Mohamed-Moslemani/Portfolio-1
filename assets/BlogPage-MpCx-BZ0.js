import{a as k,p as P,r as i,b as _,t as g,j as t,L as f}from"./index-mG0KEDE7.js";const B=l=>{if(typeof document>"u")return;let c=document.head.querySelector('link[rel="canonical"]');c||(c=document.createElement("link"),c.rel="canonical",document.head.appendChild(c)),c.href=l},E=(l,c)=>{if(typeof document>"u")return;let e=document.getElementById(l);e||(e=document.createElement("script"),e.id=l,e.type="application/ld+json",document.head.appendChild(e)),e.textContent=JSON.stringify(c)};function q(){const{slug:l}=k(),c=P.find(n=>n.slug===l),[e,S]=i.useState(c),[M,b]=i.useState(!1),[y,u]=i.useState(""),m=i.useRef(null),[h,C]=i.useState(0),[x,T]=i.useState([]),v=_(),w=i.useRef({25:!1,50:!1,75:!1,100:!1}),A=i.useMemo(()=>{if(!e?.content)return 0;const o=e.content.replace(/<[^>]+>/g," ").trim().split(/\s+/).filter(Boolean).length;return Math.max(1,Math.ceil(o/225))},[e]);i.useEffect(()=>{b(!1)},[l]);const j=typeof window<"u"?window.location.href:"",N=async()=>{try{await navigator.clipboard.writeText(j),u("Link copied"),g({action:"blog_share_copy",category:"engagement",label:l})}catch{u("Copy failed")}setTimeout(()=>u(""),1500)},$=async()=>{try{navigator.share?(await navigator.share({title:e?.title,text:e?.excerpt||e?.title,url:j}),g({action:"blog_share_native",category:"engagement",label:l})):await N()}catch{}};return i.useEffect(()=>{const n=()=>{if(!m.current)return;const o=m.current.offsetTop,s=m.current.offsetHeight,a=window.scrollY-o,r=Math.max(1,s-window.innerHeight),d=Math.min(1,Math.max(0,a/r));C(d)};return n(),window.addEventListener("scroll",n,{passive:!0}),()=>window.removeEventListener("scroll",n)},[]),i.useEffect(()=>{if(!c?.content)return;let n=c.content;const o=[];n=n.replace(/<h([23])>(.*?)<\/h\1>/gi,(s,a,r)=>{const d=r.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$|--+/g,"-");return o.push({id:d,text:r,level:Number(a)}),`<h${a} id="${d}">${r}</h${a}>`}),T(o),S({...c,content:n}),setTimeout(()=>{m.current?.querySelectorAll("pre")?.forEach(a=>{if(a.querySelector(".code-copy"))return;const r=document.createElement("button");r.className="code-copy",r.innerText="Copy",r.addEventListener("click",()=>{const d=a.querySelector("code")?.innerText||a.innerText;navigator.clipboard.writeText(d),r.innerText="Copied!",setTimeout(()=>r.innerText="Copy",1500)}),a.style.position="relative",a.appendChild(r)})},0)},[l]),i.useEffect(()=>{if(!e)return;const n=window.location.origin,o=n+v.pathname;document.title=`${e.title} | M. Moslemani`;const s=(r,d,L)=>{let p=document.head.querySelector(`${r}[${d}="${L}"]`);return p||(p=document.createElement("meta"),p.setAttribute(d,L),document.head.appendChild(p)),p},a=e.excerpt||"Blog post";s("meta","name","description").setAttribute("content",a),s("meta","property","og:title").setAttribute("content",e.title),s("meta","property","og:description").setAttribute("content",a),s("meta","property","og:type").setAttribute("content","article"),s("meta","property","og:url").setAttribute("content",o),e.cover&&s("meta","property","og:image").setAttribute("content",n+e.cover),s("meta","property","twitter:card").setAttribute("content","summary_large_image"),s("meta","property","twitter:title").setAttribute("content",e.title),s("meta","property","twitter:description").setAttribute("content",a),e.cover&&s("meta","property","twitter:image").setAttribute("content",n+e.cover),B(o),E("ld-article",{"@context":"https://schema.org","@type":"Article",headline:e.title,datePublished:e.date,author:{"@type":"Person",name:"M. Moslemani"},description:a,mainEntityOfPage:o,...e.cover?{image:n+e.cover}:{}}),E("ld-breadcrumb",{"@context":"https://schema.org","@type":"BreadcrumbList",itemListElement:[{"@type":"ListItem",position:1,name:"Home",item:n+"/"},{"@type":"ListItem",position:2,name:"Writing",item:n+"/writing"},{"@type":"ListItem",position:3,name:e.title,item:o}]})},[e,v.pathname]),i.useEffect(()=>{if(!e)return;const n=Math.round(h*100);[25,50,75,100].forEach(o=>{!w.current[o]&&n>=o&&(w.current[o]=!0,g({action:"blog_scroll_depth",category:"engagement",label:`${o}%`,value:o}))})},[h,e]),e?t.jsxs("article",{className:"blog-page",role:"article","aria-label":e.title,children:[t.jsx("div",{className:"reading-progress","aria-hidden":"true",children:t.jsx("div",{className:"reading-progress-bar",style:{width:`${h*100}%`}})}),t.jsxs("header",{className:"blog-header",children:[t.jsx("h1",{children:e.title}),t.jsxs("p",{className:"blog-meta",children:["Published ",new Date(e.date).toLocaleDateString()," • Last updated ",new Date(e.updated||e.date).toLocaleDateString()," • ",A," min read"]})]}),e.cover&&t.jsx("div",{className:"blog-cover-wrap",children:t.jsx("img",{src:e.cover,alt:e.title,loading:"lazy",className:`blog-cover ${M?"is-loaded":""}`,onLoad:()=>b(!0)})}),t.jsxs("div",{className:"blog-layout",children:[t.jsxs("main",{className:"blog-main",children:[t.jsx("div",{ref:m,className:"blog-content",dangerouslySetInnerHTML:{__html:e.content}}),t.jsx("footer",{className:"blog-footer",children:t.jsx(f,{to:"/",className:"btn btn-secondary",children:"Back to Portfolio"})})]}),t.jsxs("aside",{className:"blog-aside","aria-label":"Article tools and table of contents",children:[t.jsxs("div",{className:"blog-share-actions","aria-label":"Share actions",children:[t.jsx("button",{type:"button",className:"btn-ghost",onClick:$,children:"Share"}),t.jsx("button",{type:"button",className:"btn-ghost",onClick:N,children:"Copy link"}),y&&t.jsx("span",{className:"share-hint",children:y})]}),x.length>0&&t.jsxs("nav",{className:"blog-toc","aria-label":"Table of contents",children:[t.jsx("h3",{className:"toc-title",children:"On this page"}),x.map(n=>t.jsx("a",{href:`#${n.id}`,className:`toc-item level-${n.level}`,children:n.text},n.id))]})]})]})]}):t.jsx("div",{className:"blog-page",children:t.jsxs("div",{className:"blog-header",children:[t.jsx("h1",{children:"Post Not Found"}),t.jsx("p",{children:"The blog you are looking for doesn't exist."}),t.jsxs("div",{style:{display:"flex",gap:"0.75rem",flexWrap:"wrap"},children:[t.jsx(f,{to:"/writing",className:"btn btn-primary",children:"Browse Writing"}),t.jsx(f,{to:"/",className:"btn btn-secondary",children:"Back to Portfolio"})]})]})})}export{q as default};
